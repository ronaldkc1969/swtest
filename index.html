<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>社会福祉士 国家試験対策 Ver.2</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #e74c3c;
        }
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif; line-height: 1.6; max-width: 900px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; color: #333; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { text-align: center; color: var(--primary-color); }
        .hidden { display: none; }
        
        /* ボタン・選択肢の強化 */
        button { cursor: pointer; transition: all 0.2s; border: none; border-radius: 8px; font-weight: bold; }
        .category-btn { background: var(--accent-color); color: white; padding: 15px; font-size: 1rem; width: calc(50% - 10px); margin: 5px; }
        .category-btn:hover { background: #2980b9; transform: translateY(-2px); }
        
        .option-btn { 
            display: block; width: 100%; text-align: left; background: #fff; 
            color: #333; border: 2px solid #ddd; padding: 20px; margin-bottom: 12px; 
            font-size: 1.2rem; /* 選択肢を大きく */
            line-height: 1.4;
        }
        .option-btn:hover { border-color: var(--accent-color); background: #f8fbff; }
        
        .correct { background: #dff0d8 !important; border-color: var(--success-color) !important; color: #3c763d; }
        .incorrect { background: #f2dede !important; border-color: var(--error-color) !important; color: #a94442; }
        
        .feedback-area { margin-top: 20px; padding: 20px; border-radius: 8px; border-left: 8px solid #ddd; }
        .feedback-correct { border-color: var(--success-color); background: #e9f7ef; }
        .feedback-incorrect { border-color: var(--error-color); background: #fdf2f2; }
        
        .nav-btn { background: var(--primary-color); color: white; padding: 15px 30px; font-size: 1.1rem; margin-top: 10px; width: 100%; }
        #progress-bar { height: 10px; background: #ddd; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--success-color); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

    <h1>社会福祉士 国家試験対策</h1>

    <div id="category-screen" class="card">
        <h2>学習する分野を選択してください</h2>
        <div id="category-list" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>
    </div>

    <div id="quiz-screen" class="card hidden">
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="status-text" style="font-weight: bold; color: #666; margin-bottom: 10px;"></div>
        <h2 id="question-text"></h2>
        <div id="options-container"></div>

        <div id="feedback" class="hidden">
            <div id="feedback-style" class="feedback-area">
                <h3 id="result-message" style="margin-top:0;"></h3>
                <strong>解説:</strong>
                <p id="explanation-text"></p>
            </div>
            <button id="next-btn" class="nav-btn" onclick="nextQuestion()">次の問題へ</button>
        </div>
    </div>

    <div id="result-screen" class="card hidden">
        <h2 id="result-title">セッション終了</h2>
        <p id="score-summary" style="font-size: 1.2rem;"></p>
        <div id="retry-area">
            <button id="retest-btn" class="nav-btn" style="background: #f39c12;" onclick="startRetest()">間違えた問題に再挑戦する</button>
        </div>
        <button class="nav-btn" onclick="location.reload()">分野選択に戻る</button>
    </div>

    <script>
        // サンプルデータ（ここに19分野×30問を格納可能）
        const quizData = {
            "人体の構造と機能及び疾病": [
                { id: 1, q: "国際生活機能分類（ICF）において、身体の生理的機能を示すものはどれか。", options: ["身体機能", "身体構造", "活動", "参加"], answer: 0, exp: "「身体機能」は生命を維持するための生理的な機能を指します。「身体構造」は解剖学的な部分を指します。" },
                { id: 2, q: "リハビリテーションの本来の意味として最も適切なものはどれか。", options: ["歩行訓練の徹底", "職業訓練の実施", "全人間的復権", "病院での治療"], answer: 2, exp: "リハビリテーションは「再び適した状態にする」という意味から、全人間的な権利の回復を目指します。" }
            ],
            "社会理論と社会システム": [
                { id: 3, q: "社会的な繋がりが弱まることで起こる無秩序状態を指すデュルケムの用語は？", options: ["アノミー", "アイデンティティ", "疎外", "格差"], answer: 0, exp: "デュルケムは、急激な社会変動により社会規範が緩む状態を「アノミー」と呼びました。" }
            ]
        };

        let currentQuestions = []; // 現在解いている問題リスト
        let currentIndex = 0;
        let wrongQuestions = [];   // 間違えた問題をストック
        let score = 0;
        let isRetestMode = false;

        // 初期化：カテゴリボタン作成
        const categoryList = document.getElementById('category-list');
        Object.keys(quizData).forEach(cat => {
            const btn = document.createElement('button');
            btn.className = "category-btn";
            btn.innerText = cat;
            btn.onclick = () => initQuiz(cat);
            categoryList.appendChild(btn);
        });

        function initQuiz(category) {
            // 最初は選んだ分野の全問題をランダムにしてセット
            currentQuestions = [...quizData[category]].sort(() => Math.random() - 0.5);
            isRetestMode = false;
            startSession();
        }

        function startSession() {
            currentIndex = 0;
            score = 0;
            wrongQuestions = [];
            document.getElementById('category-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const q = currentQuestions[currentIndex];
            const progress = ((currentIndex) / currentQuestions.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('status-text').innerText = (isRetestMode ? "【再挑戦中】 " : "") + `問題 ${currentIndex + 1} / ${currentQuestions.length}`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('feedback').classList.add('hidden');
            
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i);
                container.appendChild(btn);
            });
        }

        function checkAnswer(selected) {
            const q = currentQuestions[currentIndex];
            const btns = document.querySelectorAll('.option-btn');
            const feedbackStyle = document.getElementById('feedback-style');
            btns.forEach(btn => btn.disabled = true);
            
            if (selected === q.answer) {
                btns[selected].classList.add('correct');
                document.getElementById('result-message').innerText = "⭕ 正解";
                feedbackStyle.className = "feedback-area feedback-correct";
                score++;
            } else {
                btns[selected].classList.add('incorrect');
                btns[q.answer].classList.add('correct');
                document.getElementById('result-message').innerText = "❌ 不正解";
                feedbackStyle.className = "feedback-area feedback-incorrect";
                wrongQuestions.push(q); // 間違えた問題を保存
            }

            document.getElementById('explanation-text').innerText = q.exp;
            document.getElementById('feedback').classList.remove('hidden');
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < currentQuestions.length) {
                showQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            const summary = document.getElementById('score-summary');
            const retryArea = document.getElementById('retry-area');
            
            if (wrongQuestions.length === 0) {
                summary.innerHTML = `全問正解です！完璧ですね。`;
                retryArea.classList.add('hidden');
            } else {
                summary.innerHTML = `${currentQuestions.length}問中 ${score}問正解。<br>${wrongQuestions.length}問間違えました。`;
                retryArea.classList.remove('hidden');
                document.getElementById('retest-btn').innerText = `間違えた ${wrongQuestions.length} 問に再挑戦する`;
            }
        }

        function startRetest() {
            // 間違えた問題リストを新しい出題リストにして再スタート
            currentQuestions = [...wrongQuestions].sort(() => Math.random() - 0.5);
            isRetestMode = true;
            startSession();
        }
    </script>
</body>
</html>
